# AgentDvrTelegramBot

This is a Telegram bot for monitoring and controlling an AgentDVR system, with automatic video report generation.

## Features
- Monitor video files and send alerts via Telegram
- Generate daily/nightly reports with video recordings
- Control AgentDVR system remotely via Telegram commands
- Store video metadata in a database

## Setup
1. Configure appsettings.json with your Telegram bot token, chat ID, and AgentDVR connection details
2. Set up a MySQL database and configure the connection string
3. Run the application

## Database Migration

After implementing the report status tracking feature, you need to create a database migration to add the new `report_status` table.

Run the following commands in the project directory:

```bash
dotnet ef migrations add AddReportStatusTable
dotnet ef database update
```

This will create the necessary table in your database for tracking report sending status.

## Usage
- The bot automatically monitors video files and sends alerts
- Daily reports are generated and sent at configured times
- Use Telegram commands to control the AgentDVR system:
  - `/menu` - User menu for arming/disarming
  - `/adminmenu` - Admin menu with full system control

## Implementation Details

### Report Status Tracking
The system now tracks the sending status of reports in the database:
- When a report is sent (or attempted), the status is recorded
- If a report fails to send, it will be retried on the next application launch
- This ensures no reports are lost due to temporary network issues